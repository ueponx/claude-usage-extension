# Claude使用量チェッカー Chrome拡張機能 v2.3

Claude.aiの使用量を簡単に確認できるChrome拡張機能です。

## v2.3の変更点

- ✅ **時刻表示をシンプルに**: 相対時刻（N分前）を削除し、取得時刻のみ表示
- ✅ **表示の安定性向上**: 時間経過で表示が変化しなくなった

---

## インストール方法

### ステップ1: 既存バージョンの削除（アップグレードの場合）

既に旧バージョンをインストールしている場合:

1. Chromeで `chrome://extensions/` を開く
2. Claude使用量チェッカーの**削除**をクリック

### ステップ2: v2.3のインストール

1. zipファイルをダウンロードして解凍
2. Chromeで `chrome://extensions/` を開く
3. 右上の**デベロッパーモード**をONにする
4. **パッケージ化されていない拡張機能を読み込む**をクリック
5. 解凍したフォルダを選択

---

## 使い方

### 基本操作

拡張機能をインストールすると、Claude.aiのページに**フローティングウィジェット**が自動表示されます。

**ウィジェットの機能**:
- **ドラッグ**: ウィジェットを好きな位置に移動
- **🔄ボタン**: 最新データに手動更新
- **−ボタン**: 折りたたみ/展開
- **×ボタン**: 非表示

**ウィジェットを再表示**:
- ツールバーの拡張機能アイコンをクリック
- または、ページをリロード（Ctrl+R / Cmd+R）

### 時刻表示の仕様

最終更新時刻は**HH:mm形式**で表示されます:

- **表示例**: `最終更新: 13:45`
- **特徴**: シンプルで分かりやすい、時間経過で表示が変化しない

---

## 表示される情報

- **Current Session**: 現在のセッションの使用量
- **All Models**: 全モデルの週間使用量
- **Opus Only**: Opusモデルの使用量
- **リセット時間**: 各制限のリセットタイミング

---

## 技術仕様

### キャッシュ管理

- **キャッシュ有効期限**: 5分
- **自動更新**: 5分ごとに自動更新
- **初回起動**: 自動でデータ取得
- **以降**: キャッシュから表示し、5分ごとに自動更新

### データ取得

- **方法**: 使用量ページをバックグラウンドで開いてデータを抽出
- **タブ**: 既存タブを優先利用、なければバックグラウンドで作成
- **待機時間**: ページロード後3秒待機（動的レンダリング対応）

### Manifest V3対応

- **background.js（Service Worker）**: `chrome.alarms` APIを使用（5分間隔）
  - Service Workerは30秒で停止するため、`setInterval`の代わりに`chrome.alarms`を使用
- **floating-widget.js（Content Script）**: `setInterval`を使用（5分間隔）
  - Content Scriptは通常のページコンテキストで動作するため、`setInterval`が問題なく動作
- **両方の仕組みで5分ごとに自動更新を実現**

---

## ファイル構成

```
claude-usage-extension/
├── manifest.json          # 拡張機能の設定
├── background.js          # バックグラウンド処理
├── content.js             # データ抽出
├── floating-widget.js     # ウィジェット表示
├── floating-widget.css    # スタイル
├── icons/                 # アイコン画像
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── README.md              # このファイル
```

---

## 動作確認済み環境

- **ブラウザ**: Google Chrome (最新版)
- **OS**: Windows
- **Claude.ai**: 日本語版

---

## 開発情報

### バージョン履歴

**v2.3** (2025-10-31)
- 時刻表示をシンプル化（相対時刻を削除）

**v2.2** (2025-10-31)
- background.jsのalarm間隔を5分に統一
- Manifest V3のService Worker制約に適切に対応

**v2.1** (2025-10-31)
- 自動更新を有効化（5分ごと）

**v2.0** (2025-10-31)
- 時刻表示の改善（「たった今」→実際の取得時刻）
- リロード時のタブ重複問題を修正
- データ抽出エラーの改善

**v1.6** (2025-10-31)
- リロード時のタブ重複問題を修正
- データ抽出エラーの改善

**v1.5** (2025-10-30)
- キャッシュ有効期限を5分に短縮

**v1.0-1.4**
- 初期バージョンと基本機能の実装

---

## ライセンス

MIT License

